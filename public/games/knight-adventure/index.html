<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: blob:; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; connect-src 'self' data: blob:;">

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Knight Adventure - Free Games</title>
  <style>
    html,body{margin:0;height:100%;background:#0f1530;color:#fff;font-family:Verdana,Arial,sans-serif}
    #game{width:100%;height:100%;}
    .hud{position:fixed;top:8px;left:8px;background:rgba(0,0,0,.35);padding:6px 10px;border-radius:8px;font-size:14px}
    .btns{position:fixed;top:8px;right:8px;display:flex;gap:8px}
    button{background:#f39c12;border:none;border-radius:8px;padding:8px 10px;cursor:pointer;font-weight:700}
  </style>
</head>
<body>
  <div id="game"></div>
  <div class="hud"><span id="score">Score: 0</span> <span id="timer"></span></div>
  <div class="overlay" id="overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:30;">
  <div style="background:#1b2246;border:1px solid rgba(255,255,255,.1);padding:16px 20px;border-radius:12px;max-width:320px;text-align:center;">
    <div id="overlay-text" style="margin-bottom:12px;font-weight:700;font-size:18px"></div>
    <button onclick="restart()" style="background:#f39c12;border:none;border-radius:8px;padding:8px 10px;cursor:pointer;font-weight:700">Restart</button>
  </div>
</div>
<div class="btns">
    <button onclick="togglePause()">Pause</button>
    <button onclick="restart()">Restart</button>
    <button onclick="toggleSound()">Sound</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js" crossorigin="anonymous"></script>
  <script src="./main.js"></script>
  <div class="mobile-controls" style="position:fixed;bottom:12px;left:12px;right:12px;display:flex;justify-content:space-between;gap:12px;z-index:20">
    <button id="btn-left" style="flex:1;background:#ffffff22;border:1px solid #ffffff33;color:#fff;border-radius:12px;padding:12px">◀</button>
    <button id="btn-up" style="flex:1;background:#ffffff22;border:1px solid #ffffff33;color:#fff;border-radius:12px;padding:12px">▲</button>
    <button id="btn-right" style="flex:1;background:#ffffff22;border:1px solid #ffffff33;color:#fff;border-radius:12px;padding:12px">▶</button>
  </div>
  <script>
    window.__mobile = { left:false, right:false, up:false };
    function bind(btn, key){ ['touchstart','mousedown'].forEach(e=>btn.addEventListener(e, ()=>window.__mobile[key]=true)); ['touchend','mouseup','mouseleave'].forEach(e=>btn.addEventListener(e, ()=>window.__mobile[key]=false)); }
    bind(document.getElementById('btn-left'),'left');
    bind(document.getElementById('btn-right'),'right');
    bind(document.getElementById('btn-up'),'up');
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden && window.__pause){ window.__pause(true); } });
    function showOverlay(msg){ var o=document.getElementById('overlay'); var t=document.getElementById('overlay-text'); t.textContent=msg; o.style.display='flex'; }
    function hideOverlay(){ var o=document.getElementById('overlay'); o.style.display='none'; }
  </script>
<script>
  window.addEventListener('error', function(e){ 
    if(typeof showOverlay === 'function'){ showOverlay('Load error: ' + (e && e.message ? e.message : 'Unknown')); }
    console.error('Game error:', e);
  });
  window.addEventListener('unhandledrejection', function(e){
    if(typeof showOverlay === 'function'){ showOverlay('Runtime error'); }
    console.error('Unhandled rejection:', e.reason || e);
  });
</script>
</body>
</html>
